{% extends 'vendors/base.html' %}
{% load bootstrap4 %}
{% load static %}


{% block vendor_content %}
<link rel="stylesheet" href="{% static 'css/vendor.css'%}">
<link rel="stylesheet" href="{% static 'css/lightbox.css' %}">

<div class="page-container">
  <div class="profile-head">
    <div class="background-img card">
      <img src="{{vendor.cover_image.url}}" alt="">
      <!-- <form method="POST" id="cover-form" action="{% url 'vendors:profile' slug=vendor.user.username %}"
          enctype="multipart/form-data">
          {% csrf_token %}
          <input type="file" name="cover_image" id="coverimageinput">
          <label for="coverimageinput" class="fas fa-camera profile-edit"></label>
          <input type="submit" id="cover-image-form-button" class="fas fa-camera profile-edit" name="update_cover" value="Update Cover Image">
        </form> -->
        {% if user.is_vendor and vendor.user == user %}
      <div class="card-img-overlay">
        <!-- <button type="button" class="btn btn-primary" id="cover-button-show">Edit Cover Image</button>
        <button type="button" class="btn btn-primary" id="cover-button-hide">Close</button> -->
        <i data-toggle="modal" data-target="#staticBackdrop1" class="fas fa-camera profile-edit"></i>
        <div class="modal fade change-image-modal" id="staticBackdrop1" data-backdrop="static" data-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Change Images</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form method="POST" id="cover-form" action="{% url 'vendors:profile' slug=vendor.user.username %}"
              enctype="multipart/form-data">
              {% csrf_token %}
              <input type="file" name="cover_image">
              <input type="submit" class="btn btn-primary" name="update_cover" value="Update Cover Image">
            </form>
            <br>
            <form method="POST" id="logo-form" action="{% url 'vendors:profile' slug=vendor.user.username %}"
              enctype="multipart/form-data">
              {% csrf_token %}
              <input type="file" name="logo">
              <br>
              <input type="submit" class="btn btn-primary" name="update_logo" value="Update Logo">
            </form>
          </div>
        </div>
      </div>
    </div>
      </div>
      {% endif %}
    </div>
    <div class="vendor-data">
      <img class="vendor-image" src="{{vendor.logo.url}}" alt="">
      <h3 class="vendor-name">{{vendor.vendor_name}}</h3>
      <div class="vendor-rating">
        {% ifequal vendor.review_int 1 %}
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn "></span>
        <span class="fas fa-star my-btn "></span>
        <span class="fas fa-star my-btn "></span>
        <span class="fas fa-star my-btn"></span>
        {% endifequal %}

        {% ifequal vendor.review_int 2 %}
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn "></span>
        <span class="fas fa-star my-btn "></span>
        <span class="fas fa-star my-btn"></span>
        {% endifequal %}

        {% ifequal vendor.review_int 3 %}
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn "></span>
        <span class="fas fa-star my-btn"></span>
        {% endifequal %}

        {% ifequal vendor.review_int 4 %}
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn"></span>
        {% endifequal %}

        {% ifequal vendor.review_int 5 %}
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        <span class="fas fa-star my-btn checked"></span>
        {% endifequal %}
      </div>
    </div>
  </div>
</div>
</div>
<!-- might cause error here -->
<div class="vendor-info container-fluid">
  <div class="basic-info">
    <div class="vendor-location">
      <h4><span><i class="fas fa-map-marker-alt"></i></span>
        {% if vendor.address %}
          {{vendor.address}}
        {% else %}
          <i>No address provided.</i>
        {% endif %}
        {% if user.is_vendor and vendor.user == user %}
          <span><i class="fas fa-pen" id="address-button-show" style="float: right;"></i></span>
          <span class="material-icons delete" id="address-button-hide" style="float: right;">clear</span>

          <form method="POST" id="address-form" action="{% url 'vendors:profile' slug=vendor.user.username %}">
            {% csrf_token %}
            {% bootstrap_form update_address_form %}
            <input type="submit" class="btn btn-primary" name="update_address" value="Update Address">
          </form>
        {% endif %}
      </h4>
    </div>
    <div>
      <hr class="my-2">
    </div>
    <h4>Contact</h4>
    <div class="contact-no"><span><i class="fas fa-mobile"></i></span>&nbsp;
      {% if vendor.contact %}
        {{vendor.contact}}
      {% else %}
        <i>No contact info provided.</i>
      {% endif %}
      {% if user.is_vendor and vendor.user == user %}
        <span><i class="fas fa-pen" id="contact-button-show" style="float: right;"></i></span>
        <span class="material-icons delete" id="contact-button-hide" style="float: right;">clear</span>
        <form method="POST" id="contact-form" action="{% url 'vendors:profile' slug=vendor.user.username %}">
          {% csrf_token %}
          {% bootstrap_form update_contact_form %}
          <input type="submit" class="btn btn-primary" name="update_contact" value="Update Contact">
        </form>
      {% endif %}
    </div>
    <div class="vendor-email"><span><i class="fas fa-envelope"></i></span>&nbsp;{{vendor.user.email}}</div>
    <div>
      <hr class="my-2">
    </div>
    <h4>About</h4>
    <div class="vendor-description">
      {% if vendor.about %}
        {{vendor.about|safe}}
        {% else %}
        <i>No Description.</i>
      {% endif %}

      {% if user.is_vendor and vendor.user == user %}
        <span><i class="fas fa-pen" id="about-button-show" style="float: right;"></i></span>
        <span class="material-icons delete" id="about-button-hide" style="float: right;">clear</span>
        <form method="POST" id="about-form" action="{% url 'vendors:profile' slug=vendor.user.username %}">
          {% csrf_token %}
          {% bootstrap_form update_about_form %}
          <input type="submit" class="btn btn-primary" name="update_about" value="Update About">
        </form>
      {% endif %}
    </div>
    {% if user.is_customer %}
    <button class="add-to-checklist" data-toggle="modal" data-target="#staticBackdrop2">Add to Checklist</button>
    <div class="modal fade add-modal" id="staticBackdrop2" data-backdrop="static" data-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Add Vendor to Checklist</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form method="POST" action="{% url 'vendors:profile' slug=vendor.user.username %}">
              {% csrf_token %}
              {% bootstrap_form add_checklist_form %}
              <input type="submit" class="btn btn-primary" value="Add To Checklist" name="add_to_checklist">
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
  <div class="detailed-info">
    <div class="info-tabs">
      <ul>
        <li onclick="tabs(0)" class="portfolio active">Portfolio</li>
        <li onclick="tabs(1)" class="pricing">Pricing</li>
        <li onclick="tabs(2)" class="reviews">Reviews</li>
      </ul>
    </div>
    <div class="detailed-tabs">
      <div class="detailed-portfolio tab">
        <div class="container-fluid">
          <div class="portfolio-row">
            <div class="portfolio-column">
              <!-- !Add a loop for inserting images -->
              <h4>Images:</h4>
              <div>

                {% if vendor_images %}
                  {% for image in vendor_images %}

                    <a href="{{ image.image.url }}" data-lightbox="mygallery">
                      <img src="{{ image.image.url }}" style="object-fit: cover; height: 150px; width: 250px;" alt="">
                    </a>
                    {% if user.is_vendor and vendor.user == user %}
                      <a href="{% url 'vendors:image_delete' pk=image.pk %}" class="icon">
                        <span class="material-icons delete">clear</span>
                      </a>

                    {% endif %}

                  {% endfor %}
                {% else %}
                  <i>No Images Provided.</i>
                {% endif %}
              </div>
          </div>
          <div>
            <!-- ?Button for adding image -->

            {% if user.is_vendor and vendor.user == user %}
              <form method="POST" id="image-form" action="{% url 'vendors:profile' slug=vendor.user.username %}"
                enctype="multipart/form-data">
                {% csrf_token %}
                <input type="file" name="image" id="imageinput">
                <label for="imageinput" class="fas fa-plus-circle add-image imageinputlabel"></label>
                <!-- <a href=""><i class="fas fa-plus-circle add-image"></i></a> -->
                <input type="submit" id="image-form-button" name="add_image" value="Add">
              </form>
            {% endif %}
          </div>
        </div>
      </div>
      </div>
      <div class="detailed-pricing tab">
        <div class="pricing">
          <h4>Pricing:</h4>
          <div>

            {% if vendor_pricing %}
              {% for pricing in vendor_pricing %}
              <p>
                {{pricing.description}} &nbsp;&nbsp;&nbsp; Rs. {{pricing.price}}
                {% if user.is_vendor and vendor.user == user %}
                <a href="{% url 'vendors:pricing_delete' pk=pricing.pk %}" class="icon">
                  <span class="material-icons delete">clear</span>
                </a>
                {% endif %}
              </p>
              {% endfor %}
            {% else %}
              <i>No Pricing provided.</i>
            {% endif %}

            {% if user.is_vendor and vendor.user == user %}
            <button type="button" class="btn btn-primary" id="pricing-button-show">Add Pricing</button>
            <button type="button" class="btn btn-primary" id="pricing-button-hide">Close</button>
            <form method="POST" id="pricing-form" action="{% url 'vendors:profile' slug=vendor.user.username %}">
              {% csrf_token %}
              {{add_pricing_form}}
              <input type="submit" class="btn btn-primary" name="add_pricing" value="Add">
            </form>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="detailed-reviews tab">
        {% include 'vendors/reviews.html' %}
      </div>
    </div>
  </div>
</div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="{% static 'js/lightbox.js' %}"></script>
<script src="{% static 'js/vendors.js' %}"></script>
<script>
    document.getElementById("imageinput").onchange = function() {
      document.getElementById("image-form-button").click();
    };

  $(document).ready(function () {
    $("#address-form").hide();
    $("#address-button-show").show();
    $("#address-button-hide").hide();

    $("#address-button-show").click(function () {
      $("#address-form").show();
      $("#address-button-show").hide();
      $("#address-button-hide").show();
    });

    $("#address-button-hide").click(function () {
      $("#address-form").hide();
      $("#address-button-show").show();
      $("#address-button-hide").hide();
    });

    $("#contact-form").hide();
    $("#contact-button-show").show();
    $("#contact-button-hide").hide();

    $("#contact-button-show").click(function () {
      $("#contact-form").show();
      $("#contact-button-show").hide();
      $("#contact-button-hide").show();
    });

    $("#contact-button-hide").click(function () {
      $("#contact-form").hide();
      $("#contact-button-show").show();
      $("#contact-button-hide").hide();
    });

    $("#about-form").hide();
    $("#about-button-show").show();
    $("#about-button-hide").hide();

    $("#about-button-show").click(function () {
      $("#about-form").show();
      $("#about-button-show").hide();
      $("#about-button-hide").show();
    });

    $("#about-button-hide").click(function () {
      $("#about-form").hide();
      $("#about-button-show").show();
      $("#about-button-hide").hide();
    });

    $("#pricing-form").hide();
    $("#pricing-button-show").show();
    $("#pricing-button-hide").hide();

    $("#pricing-button-show").click(function () {
      $("#pricing-form").show();
      $("#pricing-button-show").hide();
      $("#pricing-button-hide").show();
    });

    $("#pricing-button-hide").click(function () {
      $("#pricing-form").hide();
      $("#pricing-button-show").show();
      $("#pricing-button-hide").hide();
    });
})
</script>
<script src="{% static 'js/lightbox.js' %}"></script>
<script src="{% static 'js/vendor.js' %}"></script>
{% endblock vendor_content %}